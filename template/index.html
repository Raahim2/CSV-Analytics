<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV Analytics Uploader</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .file-input-hidden { width: 0.1px; height: 0.1px; opacity: 0; overflow: hidden; position: absolute; z-index: -1; }
    </style>
</head>
<body class="bg-slate-100 flex items-center justify-center min-h-screen">

    <div class="bg-white p-8 sm:p-12 rounded-2xl shadow-2xl max-w-2xl w-full mx-4">
        
        <div class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-800">Advanced CSV Analytics</h1>
            <p class="text-slate-500 mt-2 text-base sm:text-lg">Upload your CSV file to unlock powerful insights.</p>
        </div>

        <!-- IMPORTANT: Form attributes updated for Django -->
        <form id="upload-form" action="{% url 'upload_csv' %}" method="post" enctype="multipart/form-data" class="space-y-6">
            <!-- CSRF Token is CRITICAL for security -->
            {% csrf_token %}
            
            <div id="drop-zone" class="relative flex flex-col items-center justify-center w-full p-10 border-2 border-dashed border-slate-300 rounded-xl cursor-pointer hover:border-indigo-500 transition-colors duration-300 ease-in-out">
                
                <!-- IMPORTANT: Added 'name' attribute -->
                <input type="file" id="file-input" name="csv_file" accept=".csv" class="file-input-hidden">

                <div id="upload-prompt" class="text-center">
                    <svg class="mx-auto h-12 w-12 text-slate-400" stroke="currentColor" fill="none" viewBox="0 0 48 48" aria-hidden="true">
                        <path d="M28 8H12a4 4 0 00-4 4v20m32-12v8m0 0v8a4 4 0 01-4 4H12a4 4 0 01-4-4v-4m32-4l-3.172-3.172a4 4 0 00-5.656 0L28 28M8 32l9.172-9.172a4 4 0 015.656 0L28 28m0 0l4 4m4-24h8m-4-4v8" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <p class="mt-4 text-lg text-slate-600">
                        <span class="font-semibold text-indigo-600">Click to upload</span> or drag and drop
                    </p>
                    <p class="mt-1 text-sm text-slate-500">CSV files only</p>
                </div>

                <div id="file-info" class="hidden text-center">
                     <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    <p class="mt-4 text-lg font-medium text-slate-700">File ready for analysis:</p>
                    <p id="file-name" class="mt-1 text-sm text-indigo-600"></p>
                    <button type="button" id="remove-file-btn" class="mt-4 text-sm font-semibold text-red-500 hover:text-red-700">Remove file</button>
                </div>
            </div>

            <button type="submit" id="analyze-button" class="w-full bg-indigo-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-indigo-700 transition-all duration-300 ease-in-out disabled:bg-slate-400 disabled:cursor-not-allowed transform hover:scale-105 disabled:transform-none">
                Analyze Now
            </button>
        </form>
    </div>
    
    <!-- JavaScript can remain mostly the same for UI purposes -->
    <script>
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const uploadPrompt = document.getElementById('upload-prompt');
        const fileInfo = document.getElementById('file-info');
        const fileNameSpan = document.getElementById('file-name');
        const analyzeButton = document.getElementById('analyze-button');
        const removeFileBtn = document.getElementById('remove-file-btn');
        const uploadForm = document.getElementById('upload-form');

        const handleFile = (file) => {
            if (file && file.type === 'text/csv' || file.name.endsWith('.csv')) {
                fileInput.files = new DataTransfer().files; // Clear previous selection
                const dataTransfer = new DataTransfer();
                dataTransfer.items.add(file);
                fileInput.files = dataTransfer.files;

                fileNameSpan.textContent = file.name;
                uploadPrompt.classList.add('hidden');
                fileInfo.classList.remove('hidden');
                analyzeButton.disabled = false;
                dropZone.classList.add('border-green-500');
                dropZone.classList.remove('border-slate-300', 'border-indigo-500');
            } else {
                alert('Please select a valid CSV file.');
                resetUploader();
            }
        };

        const resetUploader = () => {
            fileInput.value = '';
            uploadPrompt.classList.remove('hidden');
            fileInfo.classList.add('hidden');
            analyzeButton.disabled = true;
            dropZone.classList.remove('border-green-500', 'border-indigo-500');
            dropZone.classList.add('border-slate-300');
        };

        analyzeButton.disabled = true;
        dropZone.addEventListener('click', () => { if (fileInput.value === '') fileInput.click(); });
        fileInput.addEventListener('change', (e) => handleFile(e.target.files[0]));
        dropZone.addEventListener('dragover', (e) => { e.preventDefault(); e.stopPropagation(); if (fileInput.value === '') dropZone.classList.add('border-indigo-500'); });
        dropZone.addEventListener('dragleave', (e) => { e.preventDefault(); e.stopPropagation(); if (fileInput.value === '') dropZone.classList.remove('border-indigo-500'); });
        dropZone.addEventListener('drop', (e) => { e.preventDefault(); e.stopPropagation(); dropZone.classList.remove('border-indigo-500'); handleFile(e.dataTransfer.files[0]); });
        removeFileBtn.addEventListener('click', (e) => { e.stopPropagation(); resetUploader(); });

        uploadForm.addEventListener('submit', () => {
            // Show a loading state on the button when the form submits
            analyzeButton.textContent = 'Analyzing...';
            analyzeButton.disabled = true;
        });
    </script>
</body>
</html>